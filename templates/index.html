<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Predictive Maintenance Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/boxicons@2.0.7/css/boxicons.min.css" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
        }
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .card-header {
            background-color: #fff;
            border-bottom: 1px solid #eee;
            font-weight: 600;
        }
        .metric-card {
            text-align: center;
            padding: 20px;
        }
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #0d6efd;
        }
        .metric-label {
            color: #6c757d;
            font-size: 0.9rem;
        }
        .chart-container {
            height: 400px;
            margin-bottom: 20px;
        }
        .feature-importance {
            height: 500px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class='bx bx-line-chart'></i> Predictive Maintenance Dashboard
            </a>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Metrics Section -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card metric-card">
                    <div class="metric-value" id="accuracy">-</div>
                    <div class="metric-label">Accuracy</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card metric-card">
                    <div class="metric-value" id="roc-auc">-</div>
                    <div class="metric-label">ROC AUC</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card metric-card">
                    <div class="metric-value" id="avg-precision">-</div>
                    <div class="metric-label">Average Precision</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card metric-card">
                    <div class="metric-value" id="training-time">-</div>
                    <div class="metric-label">Training Time (s)</div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="row">
            <!-- Feature Importance -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        Feature Importance
                    </div>
                    <div class="card-body">
                        <div id="feature-importance-chart" class="chart-container"></div>
                    </div>
                </div>
            </div>

            <!-- ROC Curve -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        ROC Curve
                    </div>
                    <div class="card-body">
                        <div id="roc-curve-chart" class="chart-container"></div>
                    </div>
                </div>
            </div>

            <!-- Precision-Recall Curve -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        Precision-Recall Curve
                    </div>
                    <div class="card-body">
                        <div id="pr-curve-chart" class="chart-container"></div>
                    </div>
                </div>
            </div>

            <!-- Model Parameters -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        Best Model Parameters
                    </div>
                    <div class="card-body">
                        <div id="model-params" class="feature-importance"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Load and display results
        fetch('/api/results')
            .then(response => response.json())
            .then(data => {
                // Update metrics
                document.getElementById('accuracy').textContent = (data.accuracy * 100).toFixed(2) + '%';
                document.getElementById('roc-auc').textContent = data.roc_auc.toFixed(3);
                document.getElementById('avg-precision').textContent = data.avg_precision.toFixed(3);
                document.getElementById('training-time').textContent = data.training_time.toFixed(2);

                // Plot feature importance
                const featureData = [{
                    type: 'bar',
                    x: data.feature_importance.map(f => f.Importance),
                    y: data.feature_importance.map(f => f.Feature),
                    orientation: 'h'
                }];
                Plotly.newPlot('feature-importance-chart', featureData, {
                    title: 'Feature Importance',
                    margin: { l: 150 }
                });

                // Plot ROC curve
                const rocData = [{
                    type: 'scatter',
                    x: data.roc_data.fpr,
                    y: data.roc_data.tpr,
                    name: 'ROC curve',
                    line: { color: '#0d6efd' }
                }, {
                    type: 'scatter',
                    x: [0, 1],
                    y: [0, 1],
                    name: 'Random',
                    line: { color: '#dc3545', dash: 'dash' }
                }];
                Plotly.newPlot('roc-curve-chart', rocData, {
                    title: 'ROC Curve',
                    xaxis: { title: 'False Positive Rate' },
                    yaxis: { title: 'True Positive Rate' }
                });

                // Plot PR curve
                const prData = [{
                    type: 'scatter',
                    x: data.pr_data.recall,
                    y: data.pr_data.precision,
                    name: 'PR curve',
                    line: { color: '#0d6efd' }
                }];
                Plotly.newPlot('pr-curve-chart', prData, {
                    title: 'Precision-Recall Curve',
                    xaxis: { title: 'Recall' },
                    yaxis: { title: 'Precision' }
                });

                // Display model parameters
                const paramsHtml = Object.entries(data.best_params)
                    .map(([param, value]) => `
                        <div class="mb-2">
                            <strong>${param}:</strong> ${value}
                        </div>
                    `).join('');
                document.getElementById('model-params').innerHTML = paramsHtml;
            })
            .catch(error => console.error('Error loading results:', error));
    </script>
</body>
</html> 